<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCT TV - CANAIS AO VIVO</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #030712; /* bg-gray-950 */
            color: #f9fafb; /* text-gray-50 */
        }
        /* Custom scrollbar for a better look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #111827; /* bg-gray-900 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; /* bg-gray-600 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* bg-gray-500 */
        }
        /* Enhanced Glassmorphism effect for the header */
        .glass-header {
            background: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }
        .channel-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #374151; /* border-gray-700 */
        }
        .channel-card:hover {
            transform: translateY(-6px) scale(1.04);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5), 0 0 0 2px #4f46e5; /* shadow-lg + indigo ring */
            border-color: #4f46e5; /* border-indigo-600 */
        }
        /* Fallback image style */
        .fallback-img {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-weight: 600;
            color: #d1d5db; /* text-gray-300 */
            background: linear-gradient(145deg, #374151, #1f2937);
            height: 100%;
            width: 100%;
        }
        /* Player container fullscreen styles */
        #player-container:fullscreen {
            padding: 0;
            background-color: #000;
        }
        #player-container:fullscreen .player-controls {
            border-radius: 0;
        }
        /* Fade-in animation for the grid */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="glass-header sticky top-0 z-50 py-4 px-4 sm:px-8">
        <div class="container mx-auto flex justify-between items-center gap-4">
            <h1 class="text-2xl md:text-3xl font-black tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-purple-500 to-indigo-400">
                LCT TV
            </h1>
            <div class="w-full max-w-xs md:max-w-sm">
                 <input type="text" id="search-input" placeholder="Buscar canal..." class="w-full bg-gray-800 border-2 border-gray-700 rounded-lg py-2 px-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300">
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 sm:p-8">
        
        <!-- Video Player Section -->
        <section id="player-container" class="mb-8 rounded-xl shadow-2xl bg-black transition-all duration-300">
            <div class="aspect-w-16 aspect-h-9 w-full h-full">
                <iframe 
                    id="video-player"
                    src="" 
                    frameborder="0" 
                    allow="autoplay; encrypted-media; fullscreen" 
                    allowfullscreen 
                    class="w-full h-full rounded-t-xl">
                </iframe>
            </div>
            <!-- Custom Player Controls -->
            <div class="player-controls bg-gray-800/80 p-3 flex justify-between items-center rounded-b-xl">
                <h2 id="channel-title" class="text-lg font-semibold truncate text-gray-200">Selecione um canal para assistir</h2>
                <button id="fullscreen-btn" title="Tela Cheia" class="p-2 rounded-full hover:bg-gray-700 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3">
                    </svg>
                </button>
            </div>
        </section>

        <!-- Channel List Section -->
        <section id="channels">
            <div id="loading-indicator" class="text-center py-10">
                <p class="text-lg text-gray-400">Carregando canais...</p>
            </div>
            <div id="channel-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-7 gap-4 md:gap-6 opacity-0">
                <!-- Channel cards will be inserted here by JavaScript -->
            </div>
             <div id="no-results" class="text-center py-10 text-gray-400 hidden">
                <p>Nenhum canal encontrado para sua busca.</p>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="text-center py-6 mt-8 border-t border-gray-800/50">
        <p class="text-gray-500">&copy; 2025 LEO MODZ OFC Todos os direitos reservados.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const playerContainer = document.getElementById('player-container');
            const videoPlayer = document.getElementById('video-player');
            const channelTitle = document.getElementById('channel-title');
            const channelGrid = document.getElementById('channel-grid');
            const searchInput = document.getElementById('search-input');
            const loadingIndicator = document.getElementById('loading-indicator');
            const noResultsMessage = document.getElementById('no-results');
            const fullscreenBtn = document.getElementById('fullscreen-btn');

            const API_URL = 'https://api-flixy-canais.vercel.app/all';
            let allChannels = []; // To store the fetched channels

            /**
             * Handles image loading errors by replacing the broken image with a styled div.
             * @param {HTMLElement} element - The image element that failed to load.
             * @param {string} channelName - The name of the channel for the fallback text.
             */
            function handleImageError(element, channelName) {
                const fallback = document.createElement('div');
                fallback.className = 'fallback-img';
                fallback.textContent = channelName;
                element.parentNode.replaceChild(fallback, element);
            }

            /**
             * Updates the video player and title.
             * @param {string} url - The URL of the channel player.
             * @param {string} name - The name of the channel.
             */
            function playChannel(url, name) {
                videoPlayer.src = url;
                channelTitle.innerHTML = `Assistindo agora: <span class="text-indigo-400 font-bold">${name}</span>`;
                // Scroll to the player for better visibility on mobile
                playerContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            /**
             * Fetches channel data from the API and populates the grid.
             */
            async function loadChannels() {
                try {
                    const response = await fetch(API_URL);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    
                    const channels = await response.json();
                    allChannels = channels; // Store for searching
                    
                    displayChannels(allChannels);

                    // Autoplay the first channel in the list
                    if (allChannels.length > 0) {
                        playChannel(allChannels[0].player_url, allChannels[0].nome);
                    }

                } catch (error) {
                    console.error("Failed to fetch channels:", error);
                    channelGrid.innerHTML = `<p class="text-red-500 col-span-full text-center">Falha ao carregar os canais. Tente novamente mais tarde.</p>`;
                } finally {
                    loadingIndicator.classList.add('hidden');
                    channelGrid.classList.add('fade-in'); // Trigger fade-in animation
                }
            }

            /**
             * Renders the channel cards on the page.
             * @param {Array} channels - An array of channel objects to display.
             */
            function displayChannels(channels) {
                channelGrid.innerHTML = ''; // Clear previous results
                noResultsMessage.classList.toggle('hidden', channels.length > 0);

                channels.forEach(channel => {
                    const card = document.createElement('div');
                    card.className = 'channel-card cursor-pointer bg-gray-900 rounded-lg overflow-hidden';
                    card.addEventListener('click', () => playChannel(channel.player_url, channel.nome));

                    const imageContainer = document.createElement('div');
                    imageContainer.className = 'aspect-w-4 aspect-h-3 bg-gray-800';

                    const img = document.createElement('img');
                    img.src = channel.capa;
                    img.alt = channel.nome;
                    img.className = 'w-full h-full object-contain p-3 transition-transform duration-300 group-hover:scale-105';
                    img.loading = 'lazy';
                    img.onerror = () => handleImageError(img, channel.nome);
                    
                    imageContainer.appendChild(img);

                    const nameContainer = document.createElement('div');
                    nameContainer.className = 'p-3 text-center bg-gray-800/50';

                    const name = document.createElement('p');
                    name.className = 'font-semibold text-sm truncate text-gray-200';
                    name.textContent = channel.nome;
                    
                    nameContainer.appendChild(name);
                    
                    card.appendChild(imageContainer);
                    card.appendChild(nameContainer);
                    
                    channelGrid.appendChild(card);
                });
            }
            
            /**
             * Filters channels based on the search input.
             */
            function filterChannels() {
                const query = searchInput.value.toLowerCase().trim();
                const filteredChannels = allChannels.filter(channel => 
                    channel.nome.toLowerCase().includes(query)
                );
                displayChannels(filteredChannels);
            }

            /**
             * Toggles fullscreen mode for the player container.
             */
            function toggleFullscreen() {
                if (!document.fullscreenElement) {
                    playerContainer.requestFullscreen().catch(err => {
                        alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                    });
                } else {
                    document.exitFullscreen();
                }
            }

            // Event Listeners
            searchInput.addEventListener('input', filterChannels);
            fullscreenBtn.addEventListener('click', toggleFullscreen);

            // Initial Load
            loadChannels();
        });
    </script>
</body>
</html>

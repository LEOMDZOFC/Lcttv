<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LCT TV - Login & TV Online com API</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%; font-family: 'Inter', sans-serif;
      background-color: #0f172a; color: white; overflow: hidden;
    }
    #webCanvas {
      position: fixed; top: 0; left: 0; z-index: 0; width: 100vw; height: 100vh; display: block;
    }
    #loginPage {
      position: relative; z-index: 1; height: 100vh; display: flex; justify-content: center; align-items: center;
      background: transparent;
    }
    .login-container {
      background: rgba(15, 23, 42, 0.9); padding: 2rem 3rem; border-radius: 1rem; box-shadow: 0 0 20px rgba(255,255,255,0.1);
      width: 320px; text-align: center;
    }
    .login-container input {
      width: 100%; padding: 0.75rem 1rem; margin: 0.75rem 0; border-radius: 0.5rem; border: none;
      background-color: #1e293b; color: white; font-size: 1rem; outline: none; transition: box-shadow 0.3s ease;
    }
    .login-container input:focus {
      box-shadow: 0 0 8px #fbbf24; background-color: #273549;
    }
    .login-container button {
      background: #fbbf24; color: #0f172a; font-weight: 600; padding: 0.75rem 1.5rem;
      border-radius: 0.5rem; border: none; cursor: pointer; transition: background 0.3s ease; width: 100%; margin-top: 1rem;
    }
    .login-container button:hover {
      background: #f59e0b;
    }
    .login-container h1 {
      margin-bottom: 1.5rem; font-size: 2rem; font-weight: 700; color: #fbbf24; text-shadow: 0 0 10px #fbbf24;
    }

    #tvPage {
      display: none; height: 100vh; background: #111827; color: white; padding: 1rem 2rem; overflow-y: auto;
    }
    #tvPage header {
      font-size: 2rem; font-weight: 700; color: #fbbf24; margin-bottom: 1rem; user-select: none;
    }
    #channelsList {
      display: grid; grid-template-columns: repeat(auto-fill,minmax(180px,1fr)); gap: 1rem; margin-bottom: 1rem;
    }
    .channel-card {
      background: #1f2937; border-radius: 0.75rem; cursor: pointer; overflow: hidden;
      transition: transform 0.2s ease; box-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
    }
    .channel-card:hover {
      transform: scale(1.05); box-shadow: 0 0 15px rgba(251, 191, 36, 0.7);
    }
    .channel-thumb {
      width: 100%; height: 100px; object-fit: cover; border-bottom: 1px solid #374151;
    }
    .channel-name {
      padding: 0.5rem 1rem; font-weight: 600; text-align: center;
    }
    #playerContainer {
      background: #111827; border: 2px solid #fbbf24; border-radius: 1rem; padding: 1rem;
      max-width: 900px; margin: 0 auto; user-select: none;
    }
    #playerTitle {
      font-weight: 700; font-size: 1.25rem; margin-bottom: 0.75rem; color: #fbbf24; text-align: center;
    }
    #videoPlayer {
      width: 100%; height: 480px; border-radius: 0.75rem; background: black;
    }
    #logoutBtn {
      background: #fbbf24; color: #0f172a; font-weight: 600; padding: 0.5rem 1.25rem; border-radius: 0.5rem;
      border: none; cursor: pointer; transition: background 0.3s ease; position: fixed; top: 1rem; right: 1rem; z-index: 10;
      user-select: none;
    }
    #logoutBtn:hover {
      background: #f59e0b;
    }
  </style>
</head>
<body>

  <canvas id="webCanvas"></canvas>

  <section id="loginPage">
    <div class="login-container">
      <h1>LCT TV Login</h1>
      <form id="loginForm" autocomplete="off">
        <input type="text" id="username" placeholder="Usuário" required autocomplete="username" />
        <input type="password" id="password" placeholder="Senha" required autocomplete="current-password" />
        <button type="submit">Entrar</button>
      </form>
    </div>
  </section>

  <section id="tvPage">
    <button id="logoutBtn" title="Sair">Sair</button>
    <header>LCT TV Online</header>
    <div id="channelsList"></div>

    <div id="playerContainer" style="display:none;">
      <div id="playerTitle"></div>
      <video id="videoPlayer" controls autoplay></video>
    </div>
  </section>

<script>
  const API_URL = 'https://api-flixy-canais.vercel.app/all';
  let allChannels = [];

  // === Partículas no fundo do Login ===
  const canvas = document.getElementById('webCanvas');
  const ctx = canvas.getContext('2d');
  let width, height;
  let points = [];

  function resizeCanvas() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  function createPoints(count) {
    points = [];
    for (let i = 0; i < count; i++) {
      points.push({
        x: Math.random() * width,
        y: Math.random() * height,
        vx: (Math.random() - 0.5) * 0.7,
        vy: (Math.random() - 0.5) * 0.7
      });
    }
  }

  function drawWeb() {
    ctx.clearRect(0, 0, width, height);

    for (let p of points) {
      p.x += p.vx;
      p.y += p.vy;

      if (p.x < 0 || p.x > width) p.vx *= -1;
      if (p.y < 0 || p.y > height) p.vy *= -1;

      ctx.beginPath();
      ctx.arc(p.x, p.y, 1.5, 0, Math.PI * 2);
      ctx.fillStyle = '#00ffff';
      ctx.fill();
    }

    for (let i = 0; i < points.length; i++) {
      for (let j = i + 1; j < points.length; j++) {
        const dx = points[i].x - points[j].x;
        const dy = points[i].y - points[j].y;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < 120) {
          ctx.beginPath();
          ctx.moveTo(points[i].x, points[i].y);
          ctx.lineTo(points[j].x, points[j].y);
          const alpha = 1 - distance / 120;
          ctx.strokeStyle = `rgba(0, 255, 255, ${alpha * 0.3})`;
          ctx.lineWidth = 0.7;
          ctx.stroke();
        }
      }
    }

    requestAnimationFrame(drawWeb);
  }
  createPoints(90);
  drawWeb();

  // === Seleção e exibição dos canais ===
  const channelsList = document.getElementById('channelsList');
  const playerContainer = document.getElementById('playerContainer');
  const playerTitle = document.getElementById('playerTitle');
  const videoPlayer = document.getElementById('videoPlayer');

  function renderChannels() {
    channelsList.innerHTML = '';
    if(allChannels.length === 0) {
      channelsList.innerHTML = '<p class="text-center text-yellow-400">Nenhum canal disponível.</p>';
      return;
    }
    for (const ch of allChannels) {
      const card = document.createElement('div');
      card.classList.add('channel-card');
      card.innerHTML = `
        <img src="${ch.cover}" alt="${ch.name}" class="channel-thumb" />
        <div class="channel-name">${ch.name}</div>
      `;
      card.onclick = () => playChannel(ch);
      channelsList.appendChild(card);
    }
  }

  function playChannel(channel) {
    playerTitle.textContent = channel.name;
    videoPlayer.src = channel.player_url;
    playerContainer.style.display = 'block';
    videoPlayer.play();
    playerContainer.scrollIntoView({behavior: 'smooth'});
  }

  // === Login simulada + carregamento API ===
  const loginForm = document.getElementById('loginForm');
  const loginPage = document.getElementById('loginPage');
  const tvPage = document.getElementById('tvPage');
  const logoutBtn = document.getElementById('logoutBtn');

  loginForm.addEventListener('submit', async e => {
    e.preventDefault();
    const user = document.getElementById('username').value.trim();
    const pass = document.getElementById('password').value.trim();
    if (user === '' || pass === '') {
      alert('Por favor, preencha usuário e senha.');
      return;
    }
    try {
      // Busca canais da API
      const response = await fetch(API_URL);
      if (!response.ok) throw new Error('Erro ao carregar canais');
      allChannels = await response.json();
    } catch(err) {
      alert('Erro ao carregar canais da API: ' + err.message);
      return;
    }

    loginPage.style.display = 'none';
    tvPage.style.display = 'block';
    renderChannels();

    // Ocultar partículas para TV
    canvas.style.display = 'none';
  });

  logoutBtn.addEventListener('click', () => {
    tvPage.style.display = 'none';
    loginPage.style.display = 'flex';
    playerContainer.style.display = 'none';
    videoPlayer.pause();
    videoPlayer.src = '';
    allChannels = [];

    // Mostrar partículas no login novamente
    canvas.style.display = 'block';
  });
</script>

</body>
</html>
